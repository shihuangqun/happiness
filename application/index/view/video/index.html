<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>音视频详情</title>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/>
    <link href="/index/css/mui.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="/index/css/video.css">
    <script src="/index/js/video.js"></script>

</head>
<style>
    .mui-toast-container {bottom: 50% !important}
    .mui-toast-message {background: url(/index/images/success.png) no-repeat center 10px #000; opacity: 0.6; color: #fff; width: 120px;
        padding: 70px 5px 10px 5px;border-radius: 12px;}
    .list-content a{
        color:black;
    }
    p{
        margin-bottom: 0px;
    }
    .list-box a{
       color:black;
    }
</style>
<body>
<div class="content">
    <!--视频显示-->
    <!--poster=视频封面-->
    <div class="video-box">
        <video id="video" class="video" autobuffer
               src="{$one.video_file}"
               playsinline="true"
               webkit-playsinline="true" x-webkit-airplay="true" x5-video-orientation="portraint" x5-video-player-fullscreen="true"
               type="video/mp4" poster="{$one.image}">
        </video>
        <div class="video-play" id="videoPlay" onclick="btnPlay()">
            <img src="/index/images/play_02.png" class="icon" alt="">
        </div>
    </div>
    <!--基本信息-->
    <div class="page-box">
        <div class="info-box">
            <div class="top">
                <div class="info-title-box">
                    <div class="left">{$one.title}</div>
<!--                    <div class="right">￥98</div>-->
                </div>
                <div class="info-share-box">
                    <div class="left"><img src="/index/images/video_01.png" class="icon" alt="">{$one.studynum}人学习过</div>
                    <div class="right">
                        <div id="cli">
                            <div class="item" id="switch_audio">
                                <img src="/index/images/headset.png" class="icon" alt="">
                                音频
                            </div>
                        </div>
                        <input type="hidden" id="audio" value="{$one.audio_file}">
                        <input type="hidden" id="videofile" value="{$one.video_file}">
                        <div class="item">
                            <img src="/index/images/shares.png" class="icon" alt="">
                            分享
                        </div>
                    </div>
                </div>
                <div class="info-text">{$one.description}</div>
            </div>
            <!--控件-->
            <div class="control-box">
                <div class="left" onclick="showPlayWin()">
                    <img src="/index/images/playList.png" class="icon" alt="">
                    <p class="title">播放列表</p>
                </div>
                <div class="center">
                    <div class="item previous">
                        <img src="/index/images/previous.png" alt="">
                    </div>
                    <div class="item play" onclick="btnPlay()">
                        <img src="/index/images/play.png" alt="" id="playIcon">
                        <img src="/index/images/stop.png" alt="" id="stopIcon" style="display: none">
                    </div>
                    <div class="item next">
                        <img src="/index/images/next.png" alt="">
                    </div>
                </div>
                <div class="right" onclick="fast()" style="width: 40px">
                    <!--<img src="/index/images/fast.png" class="icon" alt="">-->
                    <p id="rateDom" style="color: #666666;">1</p>
                    <p class="title">快进</p>
                </div>
            </div>
        </div>
    </div>
    <!--介绍模块-->
    <div class="introduce-box-tap" id="introduceList">
        <div onclick="introduce(this, 'introduce')" class="item act">详情介绍</div>
        <div onclick="introduce(this, 'comment')" class="item">学习感悟</div>
        <div onclick="introduce(this, 'recommend')" class="item">相关推荐</div>
    </div>
    <div class="page-box" id="introduce">
        <div class="introduce-box">
            <div class="content-introduce" id="contentIntroduce">
                {$one.video_content}
            </div>
            <div class="look" onclick="lookIntroduce(this)">查看更多</div>
        </div>
    </div>
    <!--学习感悟-->
    <div class="page-box" id="comment">
        <div class="comment-box">
            <div class="page-title-box">
                <div class="left">学习感悟</div>
<!--                <div class="right">查看更多 ></div>-->
            </div>
            <div class="list-box">
                {volist name="comment" id="c"}
                <div class="comment-item">
                    <div class="face">
                        <img src="{$c.avatar}"
                             alt="">
                    </div>
                    <div class="comment-content">
                        <div class="top-name">
                            <span class="name">{$c.nickname}</span>
                            <div class="stars" style="padding-left: 68%;position: absolute;">
                                <img src="/index/images/stars_s.png" class="stars-icon" alt="">
                                <img src="/index/images/stars_s.png" class="stars-icon" alt="">
                                <img src="/index/images/stars_s.png" class="stars-icon" alt="">
                                <img src="/index/images/stars_s.png" class="stars-icon" alt="">
                                <img src="/index/images/stars_s.png" class="stars-icon" alt="">
                            </div>
                        </div>
                        <div class="comment-text">
                            {$c.content}
                        </div>
                        <div class="bottom-time">
                            <span class="left">{$c.createtime|date="Y-m-d H:i:s",###}</span>
                            <div class="right">
<!--                                <div class="item">-->
<!--                                    <img src="/index/images/give.png" class="icon" alt="">-->
<!--                                    2-->
<!--                                </div>-->
<!--                                <div class="item">-->
<!--                                    <img src="/index/images/comment.png" class="icon" alt="">-->
<!--                                    2-->
<!--                                </div>-->
                            </div>
                        </div>
                    </div>
                </div>
            {/volist}
            </div>
        </div>
    </div>
    <!--相关推荐-->
    <div class="page-box" id="recommend">
        <div class="comment-box">
            <div class="page-title-box">
                <div class="left">相关推荐</div>
<!--                <div class="right">查看更多 ></div>-->
            </div>
            <div class="list-box">
                {volist name="recommend" id="r" length="4"}
                <a onclick="tips('{$r.price}','{$r.id}')">
                <div class="comment-item relevant-item">
                    <div class="item-lfet">
                        <img src="{$r.image}"
                             alt="">
                        <div class="time">00:09:05</div>
                    </div>
                    <div class="right-content">
                        <p class="title">{$r.title}</p>
                        <p class="text">{$r.coursecontent}</p>
                        <div class="bottom">
                            <div class="left">
                                <img src="/index/images/video.png" alt="">
                                {$r.studynum}人观看过
                            </div>
                            <div class="right">
                                ￥{$r.price}
                            </div>
                        </div>
                    </div>
                </div>
                </a>
                {/volist}

            </div>
        </div>
    </div>

    <!--底部-->
    <div class="bottom-box" style="-webkit-box-sizing: content-box;">
        <div class="input" onclick="showCommentWin()"><img src="/index/images/bi.png" class="icon" alt="" style="width: 24px;">我也来说一句...</div>
<!--        <div class="right">-->
<!--            <img src="/index/images/stars.png" alt="" id="stars" onclick="collection(1)">-->
<!--            <img src="/index/images/stars_s.png" alt="" id="stars_s" onclick="collection(0)" style="display: none">-->
<!--        </div>-->
    </div>

    <!--播放列表弹出层-->
    <!--默认隐藏-->
    <div class="play-list-box" id="playWin" style="display: none">
        <div class="bg" onclick="hidePlayWin()"></div>
        <div class="box-content">
            <div class="list-content">
                {volist name="chapter" id="vo"}
                <a href="/index/video/index/chapter_id/{$vo.id}/course_id/{$vo.course_id}"><div class="item {if condition="$one.id eq $vo.id"}act{/if}">{$vo.title}</div></a>
                {/volist}
            </div>
            <div class="close" onclick="hidePlayWin()">关闭</div>
        </div>
    </div>

    <!--评论弹窗-->
    <!--默认隐藏-->
    <div class="comment-win" style="display: none" id="commtentWin">
        <form action="" id="forms">
            <textarea oninput="input(this)" name="content" class="input" placeholder="请输入评论内容......" id="content"></textarea>
            <input type="hidden" name="course_id" value="{$one.course_id}">
            <input type="hidden" name="chapter_id" value="{$one.id}">
            <div class="score">
                五星好评哦！
                <div class="score-list">
                    <div class="item">
                        <img src="/index/images/stars_s.png" class="icon stars-s score-item-icon" alt="">
                        <img src="/index/images/stars_a.png" class="icon stars score-item-icon" alt="">
                    </div>
                    <div class="item">
                        <img src="/index/images/stars_s.png" class="icon stars-s score-item-icon" alt="">
                        <img src="/index/images/stars_a.png" class="icon stars score-item-icon" alt="">
                    </div>
                    <div class="item">
                        <img src="/index/images/stars_s.png" class="icon stars-s score-item-icon" alt="">
                        <img src="/index/images/stars_a.png" class="icon stars score-item-icon" alt="">
                    </div>
                    <div class="item">
                        <img src="/index/images/stars_s.png" class="icon stars-s score-item-icon" alt="">
                        <img src="/index/images/stars_a.png" class="icon stars score-item-icon" alt="">
                    </div>
                    <div class="item">
                        <img src="/index/images/stars_s.png" class="icon stars-s score-item-icon" alt="">
                        <img src="/index/images/stars_a.png" class="icon stars score-item-icon" alt="">
                    </div>
                </div>
            </div>
            <input type="button" class="submit" id="submit" onclick="hideCommentWin()" value="提交">
        </form>
    </div>

    <!--返回首页悬浮球-->
    <a href="/" class="go-home">
        <img src="/index/images/home.png" class="icon" alt="">
    </a>
</div>
</body>
{include file="common/footer"}
<script>

    //默认选中播放列表第一个
    // $('.list-content').find('.item').eq(0).addClass('act')

    //切换音频
    $(document).on('click','#switch_audio',function () {
        //获取音频地址
        var audio = $('#audio').val();
        //替换当前视频值
        $('#video').attr('src',audio);

        var video_html = ` <div class="item" id="switch_video">
                                <img src="/index/images/video.png" class="icon" alt="">
                                视频
                            </div>`;
        //点击后替换之前的html
        $('#cli').html(video_html)
        //切换后自动播放
        btnPlay()
    });

    //切换视频
    $(document).on('click','#switch_video',function () {
        // console.log(111)
        //获取音频地址
        var video = $('#videofile').val();
        //替换当前视频值
        $('#video').attr('src',video);

        var audio_html = ` <div class="item" id="switch_audio">
                                <img src="/index/images/headset.png" class="icon" alt="">
                                音频
                            </div>`;
        //点击后替换之前的html
        $('#cli').html(audio_html)
        //切换后自动播放
        btnPlay()
    });

    // 隐藏评论弹窗
    function hideCommentWin() {
        $.ajax({
            type:'post',
            data:$('#forms').serialize(),
            dataType:'json',
            url:'/index/video/comment',
            success: function (data) {
                console.log(data);
                if(data.code == 200){
                    mui.toast(data.msg,{ duration:1500, type:'div' })
                    setTimeout(function () {
                        $('#content').val('');
                        document.getElementById('commtentWin').style.display = 'none'
                    },1500)
                }else{
                    layer.msg(data.msg,{icon:5})
                }
            }
        })

    }
    //判断是否认证  且是否免费
    function tips(price,course_id){
        if(price == 0){
            location.href='/index/video/index/course_id/'+course_id;
        }else{
            var user_id = {$user.id};//当前用户ID

            $.ajax({
                type:'post',
                data:{course_id:course_id,user_id:user_id},
                dataType:'json',
                url:'/index/index/isbuy',
                success: function (data) {
                    //已购买
                    if(data.code == 200){
                        //跳转当前课程页面
                        location.href = data.url;
                    }else{
                        mui.confirm("此课程需要购买后才能学习，是否立即购买？",'温馨提示',['购买','取消'],function(e){
                            // console.log(e);

                            if(e.index == 0){
                                // console.log('确定');
                                var authstatus = $('#authstatus').val();

                                //不为空即已认证
                                // if(authstatus != '') location.href = '/index/order/confirm';
                                if(authstatus != ''){
                                    $.ajax({
                                        type:'post',
                                        data:{user_id:user_id,course_id:course_id},
                                        dataType:'json',
                                        url:'/index/order/ispay',
                                        success: function (data) {
                                            console.log(data);
                                            if(data.code == 200){

                                                location.href = data.url+'/user_id/'+user_id+'/course_id/'+course_id;
                                            }else{
                                                mui.confirm(data.msg,'温馨提示',['是否前往','取消'],function (e) {
                                                    if(e.index == 0){
                                                        location.href=data.url+'/user_id/'+user_id;
                                                    }
                                                })
                                            }
                                        },
                                        error: function () {
                                            console.log('error');
                                        }
                                    })
                                    // location.href = '/index/order/confirm/user_id/'+user_id+'/course_id/'+course_id;
                                }else{
                                    mui.confirm("请先完善你的个人信息",'温馨提示',['立即前往','取消'],function(e){
                                        if(e.index == 0) location.href='/index/userinfo/save';
                                    })
                                }



                            }
                        });
                    }
                }
            })

        }
    }
</script>
</html>